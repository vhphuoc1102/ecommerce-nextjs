model PmsProduct {
  productId Int @id @default(autoincrement()) @map("product_id")

  brandId          Int @map("brand_id")
  categoryId       Int @map("category_id")
  attributeGroupId Int @map("attribute_group_id")

  pmsBrand          PmsBrand          @relation(fields: [brandId], references: [brandId])
  pmsCategory       PmsCategory       @relation(fields: [categoryId], references: [categoryId])
  pmsAttributeGroup PmsAttributeGroup @relation(fields: [attributeGroupId], references: [attributeGroupId])

  name           String  @map("name") @db.VarChar(64)
  title          String  @map("title")
  subtitle       String? @map("subtitle")
  serialNumber   String  @map("serial_number") @db.VarChar(64)
  sortOrder      Int     @default(-1) @map("sort_order")
  quantity       Int     @default(0) @map("quantity")
  description    String  @default("") @map("description")
  note           String  @default("") @map("note")
  stock          Int     @default(0) @map("stock")
  lowStock       Int     @default(0) @map("low_stock")
  weight         Decimal @default(0) @map("weight")
  keyword        String  @default("") @map("keyword")
  price          Decimal @default(0) @map("price")
  originalPrice  Decimal @default(0) @map("original_price")
  promotionPrice Decimal @default(0) @map("promotion_price")
  rate           Float   @default(0) @map("rate")
  soldCnt        Int     @default(0) @map("sold_cnt")
  tag            String  @default("") @map("tag")
  giftPoint      Int     @default(0) @map("gift_point")
  growthPoint    Int     @default(0) @map("growth_point")

  status        Status        @default(ACTIVE) @map("status")
  publishStatus PublishStatus @default(DRAFT) @map("publish_status")
  newStatus     NewStatus     @default(NEW) @map("new_status")
  verifyStatus  VerifyStatus  @default(UNVERIFIED) @map("verify_status")

  pmsComments       PmsComment[]
  pmsFavorites      PmsFavorite[]
  pmsSkus           PmsSku[]
  pmsAttributeValue PmsAttributeValue[]
  pmsAlbums         PmsAlbum[]

  createTs DateTime @default(now()) @map("create_ts")
  updateTs DateTime @updatedAt @map("update_ts")

  @@map("pms_product")
}

/// Stock Keeping Unit (SKU) !== Standard Product Unit (SPU)
model PmsSku {
  skuId     Int @map("sku_id")
  productId Int @map("product_id")

  skuCode        String   @map("sku_code")
  price          Decimal  @default(0) @map("price")
  promotionPrice Decimal? @map("promotion_price")
  originalPrice  Decimal  @map("original_price")
  stock          Int      @map("stock")
  lowStock       Int      @map("low_stock")
  attribute      String   @map("attribute")
  quantity       Int      @default(0) @map("quantity")
  soldCnt        Int      @default(0) @map("sold_cnt")

  pmsProduct PmsProduct @relation(fields: [productId], references: [productId])

  @@id([skuId, productId])
  @@map("pms_sku")
}

model PmsBrand {
  brandId Int @id @default(autoincrement()) @map("brand_id")

  name        String @map("name")
  description String @default("") @map("description")
  productCnt  Int    @default(0) @map("product_cnt")
  sortOrder   Int    @default(-1) @map("sort_order")
  status      Status @default(ACTIVE) @map("status")
  keyword     String @default("") @map("keyword")

  pmsProducts PmsProduct[]

  @@map("pms_brand")
}

model PmsCategory {
  categoryId Int @id @default(autoincrement()) @map("category_id")

  name        String @default("") @map("name") @db.VarChar(64)
  level       Int    @default(1) @map("level")
  productCnt  Int    @default(0) @map("product_cnt")
  status      Status @default(ACTIVE) @map("status")
  keyword     String @default("") @map("keyword")
  description String @default("") @map("description")
  sortOrder   Int    @default(-1) @map("sort_order")

  childCategories       PmsCategory[]          @relation("parentChildren")
  parentCategory        PmsCategory?           @relation("parentChildren", fields: [parentId], references: [categoryId])
  parentId              Int?                   @map("parent_id")
  pmsProducts           PmsProduct[]
  pmsCategoryAttributes PmsCategoryAttribute[]

  @@map("pms_category")
}

model PmsAttributeGroup {
  attributeGroupId Int @id @default(autoincrement()) @map("attribute_group_id")

  name        String @map("name")
  sort        Int    @default(-1) @map("sort")
  description String @default("") @map("description")

  pmsAttributes PmsAttribute[]
  pmsProduct    PmsProduct[]

  @@map("pms_attribute_group")
}

model PmsAttribute {
  attributeId      Int           @id @default(autoincrement()) @map("attribute_id")
  attributeGroupId Int           @map("attribute_group_id")
  name             String        @map("name")
  inputType        InputType     @default(LIST) @map("input_type")
  inputList        String        @default("") @map("input_list")
  relateStatus     RelateStatus  @default(UNRELATE) @map("relate_status")
  attributeType    AttributeType @map("attribute_type")
  sortOrder        Int           @default(-1) @map("sort_order")
  searchType       SearchType    @default(NO_SEARCH) @map("search_type")

  pmsAttributeGroup     PmsAttributeGroup      @relation(fields: [attributeGroupId], references: [attributeGroupId])
  pmsAttributeValues    PmsAttributeValue[]
  pmsCategoryAttributes PmsCategoryAttribute[]

  @@map("pms_attribute")
}

model PmsAttributeValue {
  attributeValueId Int    @id @default(autoincrement()) @map("attribute_value_id")
  attributeId      Int    @map("attribute_id")
  productId        Int    @map("product_id")
  value            String @map("value")

  pmsAttribute PmsAttribute @relation(fields: [attributeId], references: [attributeId])
  pmsProduct   PmsProduct   @relation(fields: [productId], references: [productId])

  @@map("pms_attribute_value")
}

model PmsCategoryAttribute {
  categoryId  Int @map("category_id")
  attributeId Int @map("attribute_id")

  pmsCategory  PmsCategory  @relation(fields: [categoryId], references: [categoryId])
  pmsAttribute PmsAttribute @relation(fields: [attributeId], references: [attributeId])

  @@id([categoryId, attributeId])
  @@map("pms_category_attribute")
}

model PmsAlbum {
  albumId      Int    @id @default(autoincrement()) @map("album_id")
  productId    Int    @map("product_id")
  name         String @map("name") @db.VarChar(64)
  albumItemCnt Int    @default(0) @map("album_item_cnt")
  sortOrder    Int    @default(-1) @map("sort_order")
  description  String @default("") @map("description")

  pmsProduct    PmsProduct     @relation(fields: [productId], references: [productId])
  pmsAlbumItems PmsAlbumItem[]

  @@map("pms_album")
}

model PmsAlbumItem {
  albumItemId Int    @id @default(autoincrement()) @map("album_item_id")
  albumId     Int    @map("album_id")
  name        String @default("") @map("name") @db.VarChar(64)

  pmsAlbum PmsAlbum @relation(fields: [albumId], references: [albumId])

  @@map("pms_album_item")
}

model PmsComment {
  commentId Int @id @default(autoincrement()) @map("comment_id")

  productId Int @map("product_id")
  userId    Int @map("user_id")

  rate       Int    @map("rate")
  username   String @map("username")
  userIp     String @map("user_ip")
  status     Status @default(ACTIVE) @map("status")
  attribute  String @map("attribute")
  productCnt Int    @map("quantity")
  content    String @map("content")

  createTs DateTime @default(now()) @map("create_ts")
  updateTs DateTime @updatedAt @map("update_ts")

  pmsProduct      PmsProduct        @relation(fields: [productId], references: [productId])
  PmsCommentReply PmsCommentReply[]

  @@map("pms_comment")
}

model PmsCommentReply {
  commentReplyId Int @id @default(autoincrement()) @map("comment_reply_id")

  commentId  Int      @map("comment_id")
  authorId   Int      @map("author_id")
  authorType UserType @map("author_type")
  authorName String   @map("author_name")
  status     Status   @default(ACTIVE) @map("status")
  content    String   @map("content")

  createTs DateTime @default(now()) @map("create_ts")
  updateTs DateTime @updatedAt @map("update_ts")

  pmsComment PmsComment @relation(fields: [commentId], references: [commentId])

  @@map("pms_comment_reply")
}

model PmsFavorite {
  favoriteId Int @id @default(autoincrement()) @map("favorite_id")
  productId  Int @map("product_id")
  userId     Int @map("user_id")

  createTs DateTime @default(now()) @map("create_ts")
  updateTs DateTime @updatedAt @map("update_ts")

  pmsProduct PmsProduct @relation(fields: [productId], references: [productId])

  @@map("pms_favorite")
}
